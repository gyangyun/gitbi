{% extends "base.html" %}
{% block title %}Home{% endblock %}
{% block content %}
    {% if readme is not none %}
    <div>{{ readme }}</div>
    {% else %}
    <h1>Gitbi Home</h1>
    <p>[Readme file is missing]</p>
    {% endif %}
    <details open>
        <summary>Data Sources</summary>
        <figure>
        {% for db, files in databases.items() %}
            <p>
                <span class="db"><strong>{{ db|e }}</strong></span> | 
                <a href="{{ request.app.url_path_for('db_route', state=state, db=db) }}">List tables and queries</a> | 
                <a href="{{ request.app.url_path_for('query_route', db=db) }}">New query</a>
            </p>
            <details role="list">
                <summary aria-haspopup="listbox">Queries</summary>
                <ul role="listbox">
                    {% for file in files %}
                    <li><a href="{{ request.app.url_path_for('saved_query_route', state=state, db=db, file=file) }}">{{ file|e }}</a></li>
                    {% endfor %}
                </ul>
            </details>
            <div
                role="button"
                class="secondary"
                hx-get="{{ request.app.url_path_for('tables_route', db=db) }}"
                hx-trigger="click"
                hx-target="#db-details"
                hx-swap="innerHTML"
            >
                Show tables details
            </div>
            <br>
        {% endfor %}
        </figure>
    </details>
    <div id="db-details"></div>
    <details>
        <summary>Commits</summary>
        <figure>
            <table role="grid">
                <tr><th>Commit</th><th>Author</th><th>Date</th><th>Message</th></tr>
                {% for commit in commits %}
                <tr>
                    <td><a href="{{ request.app.url_path_for('home_route', state=commit.hash) }}">{{ commit.short_hash|e }}</a></td>
                    <td>{{ commit.author|e }}</td>
                    <td>{{ commit.date|e }}</td>
                    <td>{{ commit.msg|e }}</td>
                </tr>
                {% endfor %}
            </table>
        </figure>
    </details>
{% endblock %}
